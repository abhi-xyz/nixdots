<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>My Awesome Book</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->

        <meta name="description" content="This is a detailed description of the book.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">My Awesome Book</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<p>Welcome to my book! This is the introduction to my amazing content.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="chapter-1"><a class="header" href="#chapter-1">Chapter 1</a></h1>
<p>This chapter walks you through setting up a basic NixOS system. We'll aim to create a system setup comparable to a standard Linux distribution</p>
<ol start="0">
<li>Flake</li>
</ol>
<p>Why Flakes?</p>
<p>Flakes provide a structured way to manage configurations, packages, and environments in NixOS. They enable reproducible builds, improve modularity, and offer a cleaner workflow for managing system and user configurations.</p>
<h2 id="enable-flakes-permanently-in-nixos"><a class="header" href="#enable-flakes-permanently-in-nixos">Enable flakes permanently in NixOS</a></h2>
<p>Add the following to the system configuration:</p>
<pre><code class="language-nix"># configuration.nix

nix.settings.experimental-features = [ "nix-command" "flakes" ];
</code></pre>
<p>While we're here, let me show you something.</p>
<p>You can also write the above code like this:</p>
<pre><code class="language-nix"># configuration.nix

nix = {
    settings = {
        experimental-features = [ "nix-command" "flakes" ];
    };
};
</code></pre>
<p>This might not make sense right now, but it will help a lot in the readability of your code. This way, you can combine many options with the same root, like this:</p>
<pre><code class="language-nix">nix.settings.auto-optimise-store = true;
nix.settings.experimental-features = ["nix-command" "flakes"];
nix.settings.system-features = [ "big-parallel" ];
nix.gc.automatic = true;
nix.gc.dates = "weekly";
nix.gc.options = "--delete-older-than 7d";
</code></pre>
<p>is same as:</p>
<pre><code class="language-nix">nix = {
    settings = {
        auto-optimise-store = true;
        experimental-features = ["nix-command" "flakes"];
        system-features = [
            "big-parallel"
        ];
    };
    gc = {
        automatic = true;
        dates = "weekly";
        options = "--delete-older-than 7d";
    };
};
</code></pre>
<p>By grouping related settings together, the nested structure improves readability and makes it easier to manage configurations as they grow in complexity.</p>
<p>Feel free to copy the files from /etc/nixos/ to your home/user/some/dir.</p>
<blockquote>
<p>Note: If Nix complains about missing files during a build (e.g., I can't find that file), it's often because the files haven't been staged or committed. Always check whether the files are properly staged.</p>
</blockquote>
<p>Once flakes are enabled, set up your file structure like this:</p>
<pre><code class="language-bash">.
├── flake.nix 
├── configuration.nix
└── hardware-configuration.nix
</code></pre>
<p>ref: https://nixos.wiki/wiki/Flakes#Importing_packages_from_multiple_channels</p>
<pre><code class="language-nix">{
  description = "NixOS configuration with two or more channels";

  inputs = {
    nixpkgs.url = "nixpkgs/nixos-21.11";
    nixpkgs-unstable.url = "nixpkgs/nixos-unstable";
  };

  outputs = { self, nixpkgs, nixpkgs-unstable }:
    let
      system = "x86_64-linux";
      overlay-unstable = final: prev: {
        unstable = nixpkgs-unstable.legacyPackages.${prev.system};
        # use this variant if unfree packages are needed:
        # unstable = import nixpkgs-unstable {
        #   inherit system;
        #   config.allowUnfree = true;
        # };

      };
    in {
      nixosConfigurations."&lt;hostname&gt;" = nixpkgs.lib.nixosSystem {
        inherit system;
        modules = [
          # Overlays-module makes "pkgs.unstable" available in configuration.nix
          ({ config, pkgs, ... }: { nixpkgs.overlays = [ overlay-unstable ]; })
          ./configuration.nix
        ];
      };
    };
}
</code></pre>
<p>A lot is happenning here.</p>
<pre><code class="language-nix">{
  description = "NixOS configuration with two or more channels";
</code></pre>
<p>Just a description can be anything</p>
<pre><code class="language-nix">  inputs = {
    nixpkgs.url = "nixpkgs/nixos-24.11"; # pinning branch # https://github.com/NixOS/nixpkgs/tree/nixos-24.11
    nixpkgs-unstable.url = "nixpkgs/nixos-unstable"; # https://github.com/NixOS/nixpkgs/tree/nixos-unstable
  };
</code></pre>
<p><code>inputs</code> are were you describe from where you need to install pkgs. And for inputs to work we need to pass in source (eg: github, gitlab, local, etc), url and in some cases rev and hash etc. here since its from nixpkgs itself we dont need to pass in full url and source. nix will infer it. all we need is repo name/branch name.
ie, if you need an old package from nixpkgs branch 23.05 we can add</p>
<pre><code class="language-nix">  inputs = {
    nixpkgs.url = "nixpkgs/nixos-24.11"; # pinning branch https://github.com/NixOS/nixpkgs/tree/nixos-24.11
    nixpkgs-23-05.url = "nixpkgs/nixos-23.05"; # pinning branch https://github.com/NixOS/nixpkgs/tree/nixos-23.05
    nixpkgs-unstable.url = "nixpkgs/nixos-unstable"; # https://github.com/NixOS/nixpkgs/tree/nixos-unstable
  };
</code></pre>
<p>and to install programs from github repos which have flake</p>
<pre><code class="language-nix">  inputs = {
    nixpkgs.url = "nixpkgs/nixos-24.11"; # pinning branch https://github.com/NixOS/nixpkgs/tree/nixos-24.11
    nixpkgs-23-05.url = "nixpkgs/nixos-23.05"; # pinning branch https://github.com/NixOS/nixpkgs/tree/nixos-23.05
    nixpkgs-unstable.url = "nixpkgs/nixos-unstable"; # https://github.com/NixOS/nixpkgs/tree/nixos-unstable
    firefox = {
      url = "github:nix-community/flake-firefox-nightly";
      inputs.nixpkgs.follows = "nixpkgs"; # putting this on every input is a good practice.
          # cuz, while building the flake that user have also specified inputs in the flake just like us.
          # So, when we put his flake here nix will add those inputs to our config.
          #
          ## How thats a bad thing
          #
          # For the reproductive thing to work nix takes the hash of commits from github and store it in flake.lock
          # so when you add input nix will look in the github repo and identify the latest commit hash and lock it in flake.lock file.
          # ie, our packeges version is locked by that commit.
          # then every time you do rebuild your system, your packages won't be updated as the commit is locked.
          # Hence your configuration wont break when you or someone else use the same flake as both are downloading packages from same commit.
          # On a high level this is the reproducive nix offering.
          #
          # here when we put `inputs.nixpkgs.follows = "nixpkgs";` we are telling nix to take commits of nixpkgs for building firefox from our flake.
          # otherwise nix will take commits from the firefox's flake and result in downloading appro. 50mb snapshot in nixpkgs of that input commit.
          # it will led to long rebuild time in future.
    };
  };
</code></pre>
<pre><code class="language-nix">
  outputs = { self, nixpkgs, nixpkgs-unstable }:
    let
      system = "x86_64-linux";
      overlay-unstable = final: prev: {
        unstable = nixpkgs-unstable.legacyPackages.${prev.system};
        # use this variant if unfree packages are needed:
        # unstable = import nixpkgs-unstable {
        #   inherit system;
        #   config.allowUnfree = true;
        # };

      };
    in {
      nixosConfigurations."&lt;hostname&gt;" = nixpkgs.lib.nixosSystem {
        inherit system;
        modules = [
          # Overlays-module makes "pkgs.unstable" available in configuration.nix
          ({ config, pkgs, ... }: { nixpkgs.overlays = [ overlay-unstable ]; })
          ./configuration.nix
        ];
      };
    };
}
</code></pre>
<ol>
<li>
<p>wallpaper</p>
</li>
<li>
<p>audio</p>
</li>
<li>
<p>rofi</p>
</li>
<li>
<p>display manager</p>
</li>
<li>
<p>sops</p>
</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="chapter-2"><a class="header" href="#chapter-2">Chapter 2</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="conclusion"><a class="header" href="#conclusion">Conclusion</a></h1>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
